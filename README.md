---
# GOTHIC (version 1.0.0)
  * Gravitational Oct-Tree code accelerated by HIerarchical time step Controlling
  * Developed by
    * Yohei Miki (Information Technology Center, University of Tokyo)
    * Masayuki Umemura (Center for Computational Sciences, University of Tsukuba)
  * See Miki & Umemura (2017), New Astronomy, 52, 65 for detail.
  * Released under the MIT license, see LICENSE.txt for detail.
  * Copyright (c) 2017 Yohei Miki and Masayuki Umemura, All rights reserved.

# MAGI (version 1.1.0)
  * MAny-component Galaxy Initializer
  * Developed by
    * Yohei Miki (Information Technology Center, University of Tokyo)
    * Masayuki Umemura (Center for Computational Sciences, University of Tsukuba)
  * See Miki & Umemura (2018), MNRAS, 475, 2269 for detail.
  * Released under the MIT license, see LICENSE.txt for detail.
  * Copyright (c) 2017 Yohei Miki and Masayuki Umemura, All rights reserved.
---


## Included files and directories
   * README.md (this file)
   * LICENSE.txt
   * Makefile
   * src/: source files
     - src/anal: analyzers for numerical results
     - src/file: I/O subroutines
     - src/init: initial condition generators; includes MAGI: "MAny-component Galaxy Initializer"
     - src/main: source files including main
     - src/misc: common functions (definitions of structures and so on)
     - src/para: MPI subroutines for GOTHIC
     - src/plot: plot subroutines using PLplot
     - src/sort: key generator of space filling curve
     - src/time: time integration
     - src/tree: make tree structure, build LET, and walk tree
     - src/util: reduction libraries for CUDA
   * sh/: shell scripts to run GOTHIC, MAGI and related tools
     - sh/slurm: shell scripts for SLURM
     - sh/reedbush: shell scripts for Reedbush
     - sh/tsubame: shell scripts for TSUBAME 3.0
     - sh/local: shell scripts for local machine (not frequently maintained)
   * cfg/: parameter sets to describe initial conditions generated by MAGI
   * py/: Python scripts for visualization
   * plugins/: plugins for VisIt
   * plt/: gp files for GNUPLOT


## Locations of common files (not included in this package)
   * $(MYDIR) in Makefile specifies the locations
     - $(MYDIR)/inc: location of original headers
     - $(MYDIR)/lib: location of original libraries
     - $(MYDIR)/inc/common.mk: describes system configuration and locations of installed software


## Commands defined in Makefile
   * dir: create directories (bench, bin, dat, doc, fig, log)
   * gothic: compile GOTHIC: "Gravitational Oct-Tree code accelerated by HIerarchical time step Controlling"
     * sass: generate SASS file of GOTHIC
   * init: compile initial condition generators (magi, cold, and editor)
     * magi: compile MAGI: "MAny-component Galaxy Initializer"
     * cold: compile initial-condition generator of uniform sphere
     * editor: compile edit tools for initial conditions
   * plot: compile plot code using PLplot
   * anal: compile analyzers
   * m31: compile tool for simulations in M31's disk coordinate
   * clean: remove executable files and object files
   * zip: create zipped file, zipped file is moved in pub/
   * visit: generate plugins for VisIt
   * rmvisit: remove plugins for VisIt


## Options defined in Makefile
   * Overall options
     - USEDBG: 1 activates gdb and cuda-gdb; default is 0
     - USEDP: 0 is single precision mode (real is float), 1 is double precision mode (real is double); default is 0 (1 is not implemented)
     - MKOPREP: 1 generates optimization report by intel compiler for C codes; 0 is default
     - USEPAPI: 1 activates PAPI (Performance Programming Application Interface) for C codes; 0 is default
     - VERBOSE: @ suppresses the log of the compilation; null is default
   * Macros for Pre-Processor
     - DEBUG: ON suppresses function calls and so on, OFF is for debugging; default is ON
     - PROFILE: ON activates gprof; OFF is default
   * Execution options for GOTHIC
     - FORCE_SINGLE_GPU_RUN: 1 enforces single-GPU execution, 0 enables multi-GPU execution; 1 is default
     - COMBINE_WITH_J_PARALLEL: 1 enables j-parallelization when N_i is very small; 1 is default
     - MPI_AUTO_TUNE_FOR_RMAX: 1 shares parameters for auto-tuning among MPI processes; 0 is default
     - SKIP_UNUSED_LET_BUILD: 1 enables to skip building unused LETs; 1 is default
     - RECTANGULAR_BOX_FOR_LET: 1 and 0 adopts rectangular box or sphere for LET construction, respectively: 1 is default
     - ENCLOSING_BALL_FOR_LET: 1 uses efficiently bounding sphere for LET construction while 0 uses a sphere centered on the center-of-mass: 1 is default
     - COMMUNICATION_VIA_HOST: 1 enforces MPI communications via host, 0 enables GPUDirect RDMA; 0 is default
     - USE_MPI_GET_FOR_LET: 1 use MPI one-sided communications for LET exchanging; 1 is default
     - USE_MPI_GET_FOR_EXCG: 1 uses MPI one-sided communications for domain decomposition; 1 is default (0 seems to have bugs)
     - CARE_EXTERNAL_PARTICLES: 1 monitors escaping particles from local domain; 0 is default
     - ACC_ACCUMULATION_IN_DP: 1 execute accumulation of particles acceleration in double presicion; 0 is default
     - KAHAN_SUM_CORRECTION: 1 corrects particle acceleration using Kahan's algorithm; 0 is default
     - MONITOR_ENERGY_ERROR: 1 monitors time evolution of energy conservation; 1 is default
     - MONITOR_LETGEN_TIME: 1 monitors execution time of LET generator; 1 is default
     - DIVERT_GEOMETRIC_CENTER: 1 diverts geometric center as center of enclosing sphere for LETs (i.e., skip finding the exact center); 1 is default
     - ADOPT_BLOCK_TIME_STEP: 1 adopts block time step instead of shared time step; 1 is default
     - ADOPT_VECTOR_ACC_MAC: 1 adopts vector type MAC; 0 is default
     - ADOPT_GADGET_TYPE_MAC: 1 adopts acceleration MAC; 1 is default
     - ADOPT_WS93_TYPE_MAC: 1 adopts multipole MAC; 1 is default
     - IJ_PARALLELIZED_WALK: 1 enables ij-parallelization in tree traverse; 1 is default
     - CLOCK_BASED_AUTO_TUNING: 1 uses GPU clock cycles for auto-tuning; 1 is default
     - OMIT_VELOCITY_BASED_DT: 1 uses only acceleration to determine time step; 0 is default
     - REPORT_COMPUTE_RATE: 1 enables reporting computing speed; 1 is default
     - REPORT_ELAPSED_TIME: 1 reports elapsed time of representative functions in every step; 1 is default
     - REPORT_CLOCK_FREQUENCY: 1 reports clock frequency of GPU; 1 is default
     - USE_COOPERATIVE_GROUPS: 1 adopts cooperative groups for global synchronization; 0 is default (slower than original global synchronization)
     - GET_NBLOCKS_PER_SM_AUTO: 1 automatically set # of blocks per SM for various function; 1 is default
   * File format options for MAGI (shared with GOTHIC)
     - DATAFILE_FORMAT_HDF5: 1 uses HDF5 container; 1 is default
     - HDF5_FOR_ZINDAIJI: 1 generates additional data for Zindaiji in HDF5 files; 0 is default
     - DUMPFILE_IN_TIPSY: 1 writes data files in TIPSY format; 0 is default
     - DUMPFILE_AS_GALACTICS: 1 writes data files in GalactICS format; 0 is default
   * Execution options for MAGI (shared with GOTHIC)
     - USE_OFFICIAL_SFMT: 1 uses SFMT (SIMD-oriented Fast Mersenne Twister developed by Mutsuo Saito and Makoto Matsumoto); 1 is default
     - USE_OFFICIAL_SFMT_JUMP: 1 uses SFMT-jump (jump function for SFMT developed by Mutsuo Saito and Makoto Matsumoto); 1 is default
     - USE_LIS_FOR_MAGI: 1 uses Lis (Library of Iterative Solvers for linear systems developed by Nishida et al.); 1 is default
     - SET_EXTERNAL_FIELD: 1 outputs radial profiles of each components' potential for N-body simulations; 0 is default
     - SET_EXTERNAL_FIELD_DISK: 1 outputs potential field of disk components for N-body simulations; 1 is default (automatically disabled if SET_EXTERNAL_FIELD is 0)
     - ADAPTIVE_EXTERNAL_FIELD: 1 uses adaptive gridding instead of regular grid for numeric tables for potential profiles; 0 is default
     - USE_ZH78_RETROGRADING: 1 produces retrograding particles using Equation (5) of Zang & Hohl (1978); 0 is default
   * Debugging options
     - EVALUATE_FORCE_ERROR: 1 compares acceleration and potential calculated by direct-sum and tree method; 0 is default
   * Benchmark options
     - MEASURE_ELAPSED_TIME: 1 reports elapsed time of representative functions in every step; 0 is default
     - MEASURE_EXEC_METRICS: 1 reports # of interactions in every step (necessary to estimate Flops); 0 is default
     - HUNT_OPTIMAL_WALK_TREE: 1 allows putting parameter sets related to tree traversal from Makefile; 0 is default
     - HUNT_OPTIMAL_INTEGRATE: 1 allows putting parameter sets related to time integration from Makefile; 0 is default
     - HUNT_OPTIMAL_MAKE_TREE: 1 allows putting parameter sets related to tree construction from Makefile; 0 is default
     - HUNT_OPTIMAL_MAKE_NODE: 1 allows putting parameter sets related to calculate multipole moments from Makefile; 0 is default
     - HUNT_OPTIMAL_NEIGHBOUR: 1 allows putting parameter sets related to find neighbour particles; 0 is default
     - HUNT_OPTIMAL_SEPARATION: 1 allows putting parameter sets related to set minimum particle separation; 0 is default
     - MEASURE_NI_DEPENDENCE: 1 reports elapsed time of tree walk as a function of Ni; 0 is default


## Some additional notes related to tree walk
   * real is float (only the single precision can be compiled)
   * macros in src/tree/walk_dev.cu
     - NTHREADS: # of threads per block
     - TSUB: # of threads that share the group of i-particles
     - NWARP: # of threads that share the same i-particle
     - NLOOP: parameter to determine the length of local interaction list


## Caveats
   * performance issue in MPI parallelized version of GOTHIC


## Workarounds
   * if you receive error message without any prescription, then try smaller value for TREE_SAFETY_VAL defined in src/tree/make.h


## Future update plans
   * GOTHIC
     - performance enhancements of MPI version
     - refactoring of flags related to enclosing ball
   * MAGI
     - performance enhancements of generating potential-density pair of the disk component(s)
     - rotation of spherical components (in arbitrary rotation axis)
     - development of MPI parallelized versoin
